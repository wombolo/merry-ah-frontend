apiVersion: v1
kind: Pod
metadata:
  name: "jenkins-slave-container"
spec:
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - preference:
            matchExpressions:
              - key: cloud.google.com/gke-preemptible
                operator: Exists
          weight: 100
  containers:
  - name: "node-es-container"
    image: node:carbon
    resources:
      requests:
        cpu: "100m"
        memory: "300Mi"
      limits:
        cpu: "200m"
        memory: "500Mi"
    command:
    - cat
    tty: true
    env:
      - name: DOCKER_HOST
        value: tcp://0.0.0.0:2375

  - name: dind
    image: docker:19.03-dind
    securityContext:
      privileged: true
    volumeMounts:
      - name: jenkins-disk
        mountPath: /var/lib/docker
#  volumes:
#  - name: jenkins-disk
#    gcePersistentDisk:
#      pdName: jenkins-disk
#      fsType: ext4
  volumes:
    - name: jenkins-disk
      emptyDir: {}
